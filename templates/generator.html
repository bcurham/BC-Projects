<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Test Script Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Automated Test Script Generator</h1>
            <p class="subtitle">Generate GxP-compliant test scripts from URS documents</p>
        </header>

        <main>
            <div class="upload-section">
                <div class="card">
                    <h2>Upload Documents</h2>

                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="ursFile">
                                <span class="label-text">URS Document</span>
                                <span class="label-hint">Upload your User Requirements Specification (PDF, DOCX, or TXT)</span>
                            </label>
                            <div class="file-input-wrapper">
                                <input type="file" id="ursFile" name="urs_file" accept=".pdf,.docx,.txt" required>
                                <span class="file-name" id="ursFileName">No file selected</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="templateFile">
                                <span class="label-text">Test Script Template</span>
                                <span class="label-hint">Upload your Word template with the test script table (DOCX)</span>
                            </label>
                            <div class="file-input-wrapper">
                                <input type="file" id="templateFile" name="template_file" accept=".docx" required>
                                <span class="file-name" id="templateFileName">No file selected</span>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="generateBtn" class="btn btn-primary">
                                Generate Test Script
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="loadingSection" class="loading-section hidden">
                <div class="spinner"></div>
                <p id="loadingText">Processing your documents...</p>
            </div>

            <div id="previewSection" class="preview-section hidden">
                <div class="card">
                    <div class="preview-header">
                        <h2>Generated Test Script - Preview & Edit</h2>
                        <p class="preview-subtitle">Review the populated test script table below. Click on any cell to edit before downloading.</p>
                    </div>
                    <div class="table-preview-container">
                        <div id="previewContent"></div>
                    </div>
                    <div class="preview-actions">
                        <button id="closePreview" class="btn btn-secondary">
                            <span>‚Üê Start Over</span>
                        </button>
                        <button id="downloadBtn" class="btn btn-primary">
                            <span>Download Word Document ‚Üí</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Enhanced Validation Features (Optional - appears after test script generation) -->
            <div id="enhancedFeaturesSection" class="enhanced-features-section hidden">
                <div class="card">
                    <div class="features-header">
                        <h2>üìä Additional Validation Tools</h2>
                        <p class="features-subtitle">Generate compliance documentation and analysis reports</p>
                    </div>

                    <!-- Feature Tabs -->
                    <div class="feature-tabs">
                        <button class="feature-tab active" data-tab="rtm">
                            <span class="tab-icon">üîó</span>
                            <span class="tab-text">Traceability Matrix</span>
                        </button>
                        <button class="feature-tab" data-tab="validation">
                            <span class="tab-icon">üìã</span>
                            <span class="tab-text">Validation Docs</span>
                        </button>
                        <button class="feature-tab" data-tab="quality">
                            <span class="tab-icon">‚úì</span>
                            <span class="tab-text">Quality Check</span>
                        </button>
                        <button class="feature-tab" data-tab="changes">
                            <span class="tab-icon">üîÑ</span>
                            <span class="tab-text">Change Impact</span>
                        </button>
                        <button class="feature-tab" data-tab="audit">
                            <span class="tab-icon">üì¶</span>
                            <span class="tab-text">Audit Package</span>
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-contents">
                        <!-- RTM Tab -->
                        <div id="rtmTab" class="tab-content active">
                            <h3>Requirements Traceability Matrix</h3>
                            <p>Generate RTM mapping all requirements to test cases</p>
                            <div class="button-group">
                                <button id="generateRTMExcel" class="btn btn-primary">
                                    <span>Download RTM (Excel)</span>
                                </button>
                                <button id="generateRTMWord" class="btn btn-secondary">
                                    <span>Download RTM (Word)</span>
                                </button>
                            </div>
                        </div>

                        <!-- Validation Docs Tab -->
                        <div id="validationTab" class="tab-content">
                            <h3>Validation Documentation</h3>
                            <p>Generate GxP-compliant validation master plan and summary report</p>
                            <div class="button-group">
                                <button id="generateVMP" class="btn btn-primary">
                                    <span>Download Validation Plan (VMP)</span>
                                </button>
                                <button id="generateVSR" class="btn btn-secondary">
                                    <span>Download Summary Report (VSR)</span>
                                </button>
                            </div>
                        </div>

                        <!-- Quality Check Tab -->
                        <div id="qualityTab" class="tab-content">
                            <h3>Requirements Quality Analysis</h3>
                            <p>AI-powered analysis of requirement quality and testability</p>
                            <button id="runQualityCheck" class="btn btn-primary">
                                <span>Run Quality Check</span>
                            </button>
                            <div id="qualityResults" class="quality-results hidden"></div>
                        </div>

                        <!-- Change Impact Tab -->
                        <div id="changesTab" class="tab-content">
                            <h3>Change Impact Analysis</h3>
                            <p>Compare against previous URS versions to identify changes</p>
                            <button id="runChangeAnalysis" class="btn btn-primary">
                                <span>Analyze Changes</span>
                            </button>
                            <div id="changeResults" class="change-results hidden"></div>
                        </div>

                        <!-- Audit Package Tab -->
                        <div id="auditTab" class="tab-content">
                            <h3>Complete Audit Package</h3>
                            <p>Export all validation artifacts as a comprehensive ZIP package</p>
                            <div class="audit-package-info">
                                <h4>Package includes:</h4>
                                <ul>
                                    <li>‚úì User Requirements Specification (URS)</li>
                                    <li>‚úì Test Scripts</li>
                                    <li>‚úì Requirements Traceability Matrix (RTM)</li>
                                    <li>‚úì Validation Master Plan (VMP)</li>
                                    <li>‚úì Validation Summary Report (VSR)</li>
                                    <li>‚úì Quality Analysis Report</li>
                                    <li>‚úì Package Metadata</li>
                                </ul>
                            </div>
                            <button id="exportAuditPackage" class="btn btn-primary btn-large">
                                <span>üì¶ Export Complete Audit Package</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="errorSection" class="error-section hidden">
                <div class="alert alert-error">
                    <strong>Error:</strong>
                    <p id="errorMessage"></p>
                </div>
            </div>

            <div id="successSection" class="success-section hidden">
                <div class="alert alert-success">
                    <strong>Success!</strong>
                    <p>Your test script has been generated and downloaded.</p>
                </div>
            </div>
        </main>

        <footer>
            <p class="info-text">
                This tool uses AI to parse URS documents and generate test scripts compliant with
                FDA 21 CFR Part 11 and GxP requirements. Always review generated content before use.
            </p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
